namespace Skew.Tests {
  def toString(list List<int>) string {
    return "[" + ", ".join(list.map<string>(x => x.toString)) + "]"
  }

  def testUnicodeText(text string, codePoints List<int>) {
    test("codePoints " + text, expectString => expectString(toString(codePoints), toString(text.codePoints)))
    test("fromCodePoints " + text, expectString => expectString(text, string.fromCodePoints(codePoints)))
    test("codeUnits " + text, expectString => expectString(text, string.fromCodeUnits(text.codeUnits)))
    for codePoint in codePoints {
      test("fromCodePoint " + codePoint.toString, expectString =>
        expectString(toString([codePoint]), toString(string.fromCodePoint(codePoint).codePoints)))
    }
  }

  def testUnicodeCount(text string, count int) {
    test("count " + text, expectString => expectString(count.toString, text.count.toString))
  }

  def testUnicode {
    # Make sure encoding and decoding works
    testUnicodeText("Ğ¦Ğ»Ñ—Ï‚ÏƒÎ´Îµ", [1062, 1083, 1111, 962, 963, 948, 949])
    testUnicodeText("ï¾Œï¾‘ï½±ï¾‘ï½¶ï¾“ï½¹ï¾“", [65420, 65425, 65393, 65425, 65398, 65427, 65401, 65427])
    testUnicodeText("ãƒ•ãƒ ãƒ¤ãƒ ã‚«ãƒ¢ã‚±ãƒ¢", [12501, 12512, 12516, 12512, 12459, 12514, 12465, 12514])
    testUnicodeText("ãŠ€ãŠãŠ‚ãŠƒãŠ„", [12928, 12929, 12930, 12931, 12932])
    testUnicodeText("â˜³â˜¶â˜²", [9779, 9782, 9778])
    testUnicodeText("ğ¡‡™ğŒ†", [135641, 119558])

    # Make sure target-specific constant folding of string.count works correctly
    testUnicodeCount("Ğ¦Ğ»Ñ—Ï‚ÏƒÎ´Îµ", "Ğ¦Ğ»Ñ—Ï‚ÏƒÎ´Îµ".count)
    testUnicodeCount("ï¾Œï¾‘ï½±ï¾‘ï½¶ï¾“ï½¹ï¾“", "ï¾Œï¾‘ï½±ï¾‘ï½¶ï¾“ï½¹ï¾“".count)
    testUnicodeCount("ãƒ•ãƒ ãƒ¤ãƒ ã‚«ãƒ¢ã‚±ãƒ¢", "ãƒ•ãƒ ãƒ¤ãƒ ã‚«ãƒ¢ã‚±ãƒ¢".count)
    testUnicodeCount("ãŠ€ãŠãŠ‚ãŠƒãŠ„", "ãŠ€ãŠãŠ‚ãŠƒãŠ„".count)
    testUnicodeCount("â˜³â˜¶â˜²", "â˜³â˜¶â˜²".count)
    testUnicodeCount("ğ¡‡™ğŒ†", "ğ¡‡™ğŒ†".count)
  }
}
